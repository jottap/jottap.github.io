---
import { getCollection } from "astro:content";
import ProjectLayout from "../../../layouts/ProjectLayout.astro";

export async function getStaticPaths() {
    const projects = await getCollection("projects");

    // Filter for PT context:
    // 1. Legacy PT files (slug or id starts with 'pt/')
    // 2. Unified files (no language prefix in id/slug)
    const ptProjects = projects.filter((p) => {
        const id = p.id;
        return id.startsWith("pt/") || !id.includes("/");
    });

    return ptProjects.map((entry) => {
        // Normalize slug: remove 'pt/' prefix if present
        let cleanSlug = entry.slug || entry.id;
        if (cleanSlug.startsWith("pt/")) {
            cleanSlug = cleanSlug.replace("pt/", "");
        }
        if (cleanSlug.endsWith(".md")) {
            cleanSlug = cleanSlug.replace(".md", "");
        }

        return {
            params: { slug: cleanSlug },
            props: { entry },
        };
    });
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

{/* Delegate Rendering to the Unified Layout */}
{
    /* We explicitly pass lang="pt" to force Portuguese context for everything rendered here */
}
<ProjectLayout {...entry.data} lang="pt">
    <Content />
</ProjectLayout>
